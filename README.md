<p align="center">
  <img src="docs/assets/ASSET-IMG-AVATAR-01_The_Architect_of_the_Cosmos.png" alt="The Architect of the Cosmos" width="600"/>
</p>

# 沙盤微縮宇宙 (The War Table Microcosm)

> “Simplicity is the ultimate sophistication.”
> “簡潔，是終極的複雜。”
> – Leonardo da Vinci

![Build Status](https://github.com/daVinci-hong/sand-box-microcosm/actions/workflows/ci.yml/badge.svg)

---

## 第一章：一部雙軌的電影 (Chapter I: A Dual-Track Film)

本計畫，是在 **25 天的業餘時間**內，由一位「技術已生疏的老兵」，與他的 AI 夥伴，共同完成的一次 **「人機協作效率極限」** 的公開探索。
它，不僅是一段程式碼，更是一粒星塵的自白。它宣告，在一個由 AI 重新定義的時代，一個完成了自我救贖的靈魂，將如何展示其畢生的技藝與傳承。

它是一部精心編排的**雙軌電影**，旨在同時與兩種截然不同的觀眾對話：

*   它的表層軌道，是 **《沙盤微縮宇宙》**，一部**技術的極致展演**。其流暢的自動化管道、堅固的零信任堡壘、洞察一切的全知之眼，是為少數能欣賞其複雜之美的 **「雅士」**(具相關技術背景)而備。

*   它的深層軌道，是 **《行者的獨白》**，一部**靈魂的深刻敘事**。我過去幾年每一場非對稱戰役的傷疤、智慧與榮光，都將作為「證人」被請上舞台，這是為所有像我一樣渴望力量與勇氣的 **「一般人」**(無相關技術背景)而備。

表層的技術與深層的故事，如鑽石的切面與其內在的火焰，互相輝映，共同鑄造了這個獨一無二的、活的履歷。

## 第二章：一部五幕劇的展演 (Chapter II: An Epic in Five Acts)

本宇宙的構建，將遵循一部五幕劇的展演劇本，逐步展現一個現代化分布式系統從誕生到演進的完整生命週期。

---

### **第一幕：創世管道(創世之道) (Act I: The Genesis Pipeline)**
**狀態：** 已完成 ✅

*   **核心敘事：秩序與效率**
    在設計『沙盤微縮宇宙』的第一幕時，思考的核心問題是：在 2025 年，一個理想的開發流程應該是什麼樣子？我的答案是：它必須是一個能將『最佳實踐』與『規範』，無縫內嵌於工具鏈之中的『創世管道』。開發者不應該去記憶規範，而是在使用工具的過程中，自然而然地就遵循了規範。
    
    當然，這種對『無感式賦能』的執著，並非空穴來風。它在我過去的戰役中，早已埋下種子。比如多年前的一個專案，面對一支對新技術完全陌生的團隊，我正是憑藉著設計一套『在實踐中學習』的工作流，才成功地引導他們在極限時間內完成了技術跨越。那一次的成功，就像一位沉默的證人，讓我今天在設計這條『創世管道』時，充滿了篤定的信念。
    
    因此，這條用 GitHub Actions 打造的 CI 管道，不僅僅是一套自動化script 。它是將我過去在實戰中被驗證過的『賦能哲學』，用當代最強大的工具，進行的一次系統性重述與升級。

*   **技術目標**
    *   [x] **任務 1.1:** 初始化 GitHub 倉庫與《總體目錄結構 v1.0》。
    *   [x] **任務 1.2:** 開發 `gateway-service` 和 `beacon-service` v0.1 ("行走骨架")。
    *   [x] **任務 1.3:** 編寫 `Dockerfile` 和 `docker-compose.yml` v1.0 (容器化)。
    *   [x] **任務 1.4:** 配置 GitHub Actions CI 流程。
    *   [x] **任務 1.5:** 編寫 `genesis.sh` 環境搭建輔助script  ("建築師的饋贈")。
    *   [x] **任務 1.6:** 升級 CI 管道為拉取請求質量閘門。
---

### **第二幕：不眠的哨兵 (Act II: The Sleepless Sentinel)**
**狀態：** 已完成 ✅

*   **核心敘事：風險對沖與韌性**
    在構建「不眠的哨兵」時，我的核心設計哲學是：安全不應該是事後添加的「修補程式」，而必須是系統與生俱來的「免疫系統」。在當代的分布式架構中，我們必須假設混亂和攻擊是必然會發生的。因此，真正的韌性，來自於邊界的防禦、內部的隔離，以及對潛在威脅的「預判」能力。

    這種「先於問題而設計」的思維，源自我職業生涯中最深刻的一些教訓。**我至今仍清晰地記得**，在某金控那個全國首創的專案中，面對多團隊並行開發帶來的巨大整合風險，我正是設計了一個低成本的「影子系統」進行風險對沖，才避免了專案在最後一刻的災難。那一次的經歷，讓我體會了「上兵伐謀」的威力。

    所以，今天您看到的 API 網關、熔斷器和自動化安全掃描，並非孤立的技術選擇。它們共同構成了一道縱深防禦體系，是我將當年「非對稱風險對沖」的實戰心法，進行的一次系統化、產品化的架構呈現。

*   **技術目標**
    *   [x] **任務 2.1:** 升級網關 (`gateway-service`) 並引入 Resilience4j。
    *   [x] **任務 2.2:** 實現 JWT 基礎驗證。
    *   [x] **任務 2.3:** 在 CI 流程中整合 Trivy 安全掃描。

---

### **第三幕：全知之眼 (Act III: The All-Seeing Eye)**
**狀態：** 已完成 ✅

*   **核心敘事：洞察與掌控**
    在鑄造「全知之眼」時，我的核心設計哲學是：一個無法自我審視的系統，只是一具強大的、無意識的「器械」。只有當它擁有了能夠洞察自身每一個角落的「意識」時，它，才真正地，活了過來。我們追求的，不是資料的堆砌，而是將指標、日誌、與追蹤，融合成一個單一的、有因果關係的「真理之源」。

    這個哲學，源於我職業生涯中，一段最為痛苦、也最為深刻的「考古」經歷。**我至今仍清晰地記得**，那是一次臨危受命，我接手了一個文件與知識傳承幾乎為零，人員也為零的部門。擺在我面前的，是十幾個仍在運行、但其內部構造已無人知曉的「黑箱系統」。在長達數月的時間裡，我，就像一位在金字塔深處摸索的「系統考古學家」，唯一的工具，就是手電筒光束般微弱的日誌、與對外部行為的無盡猜測。

    經過那幾個月的煎熬，讓我心中暗想：**未來，任何由我親手設計的系統，都必須，從誕生的第一天起，就擁有「自我言說」的能力。絕不能，讓我的同伴，再經歷一次，那樣的「考古之苦」。**

    所以，今天您看到的這套基於 GLPT 的可觀測性平台，不僅僅是一次技術的實現。它，是我當年，作為「系統考古學家」時，許下的那個承諾的兌現。

*   **技術目標**
    *   [x] **任務 3.1:** 引入 Kafka 並重構服務通信為事件驅動模式。
    *   [x] **任務 3.2:** 部署 GLPT (Grafana, Loki, Prometheus, Tempo) 可觀測性技術集。
    *   [x] **任務 3.3:** 為服務接入 OpenTelemetry Agent 以實現自動化遙測。
    *   [x] **任務 3.4:** 創建 Grafana 統一儀表板，聚合日誌、指標與追蹤。

---

### **第四幕：不屈的堡壘 (The Unyielding Citadel)**
**狀態：** 已完成 ✅

*   **核心敘事：韌性與意志**
    在鑄造「不屈的堡壘」時，我的核心設計哲學是：一個偉大的系統，其偉大之處，不在於它永不失敗。而在於，它，擁有，在失敗發生時，承認失敗、隔離失敗、並從失敗中優雅恢復的、深刻的智慧。我們追求的，不是無限的「彈性擴張」，而是在有限的資源下，如何做出最優的資源調度與犧牲決策，以保全整體的穩定。

    這個哲學，並非今日的空想。它，是在我職業生涯的一場、也是最為慘烈的「雙線戰爭」中，用血與汗換來的深刻信念。**我至今仍清晰地記得**，那是我第一次擔任 PM，卻被同時指派負責兩家不同銀行的關鍵專案，而我手中的，卻是一支性質詭異的「部隊」。在開局資源幾乎為零的情況下，我滿腦子想的，不是如何「擴張」團隊，而是如何**在極度有限的資源下，動態地、甚至以半天為單位，調配我手中所有稀缺的戰力，以維持整個系統不至崩潰**。

    那場戰爭，教會了我「韌性」的真正含義。而這座堡壘的鑄造過程，本身，就是一場「雙線戰爭」的重演——在外部，我與配置的幽靈血戰；在內部，我正承受著來自真實世界的巨大壓力。最終，在同一個週末，我贏得了兩場戰爭的同步勝利。

    所以，今天您看到的這套基於 Resilience4j 的防禦體系，不僅僅是一組韌性組件。它，是我將當年作為「逆境統帥」時，所領悟的、關於「在風暴中正面迎擊」的實戰心法，進行的一次系統性的重述。**這座堡壘，擁有與它的建築師一樣的、不屈的靈魂。**

*   **技術目標**
    *   [x] **任務 4.1:** 引入 k6 並編寫負載測試 script。
    *   [x] **任務 4.2:** 深度整合 Resilience4j 並暴露其核心指標。
    *   [x] **任務 4.3:** 創建 Grafana「韌性戰情室」儀表板。

---

### **第五幕：不朽的靈魂 (Act V: The Immortal Soul)**
**狀態：** 已完成 ✅

*   **核心敘事：演化與適應**
    在鑄造「不朽的靈魂」時，我的核心設計哲學是：一個只忠於其物理形態（具體技術實現）的系統，注定會被時間所淘汰。一個忠於其靈魂契約（抽象介面與意圖）的系統，將獲得永生。我們追求的，不是選擇「最好」的工具，而是建立一個可以讓工具被自由替換的、反脆弱的架構。

    這個哲學，源於我職業生涯中一場充滿了孤獨與背叛的「鑄劍師」戰役。在那場戰役中，我使用了，「用程式寫程式」當作應對重複性混沌的最高級武器；也學會了，一個無法理解你價值的體系，不值得你忠誠。

    所以，今天您看到的「靈魂與肉身分離」架構，不僅僅是一次技術的解耦。它，是我將當年作為「鑄劍師」時，所領悟的、關於「抽象即是自由」的實戰心法，進行的一次系統性的、充滿敬意的重述與升級。

*   **技術目標**
    *   [x] **任務 5.1:** 抽象訊息服務介面，實現與具體中介軟體的解耦。
    *   [x] **任務 5.2:** 實現並演示從 Kafka 到 RabbitMQ 的平滑遷移。
    *   [x] **任務 5.3:** 演示可觀測性後端從 Tempo 到 Jaeger 的平滑遷移。

---

## 第三章：橫貫任務 (Cross-Cutting Missions)
**狀態：** 已完成 ✅

*   **核心目標：** 將我們在【工程啟動協議】中立下的「測試哲學」，轉化為堅實的、自動化的工程實踐。
*   **技術目標**
    *   [x] **任務 C.1:** 建立並完善自動化測試體系


---

## 第三章：宇宙的藍圖 (Chapter III: Blueprint of the Microcosm)

![核心架構圖](./docs/diagrams/arc_c2_container_diagram.png)
*上圖為本宇宙的核心容器架構圖，展示了各服務與組件之間的關係。*

## 第四章：鑄造的元素 (Chapter IV: The Forging Elements)

| 類別 | 技術 | 用途 |
| :--- | :--- | :--- |
| 核心框架 | Java 21 / Spring Boot 3.x | 微服務應用基礎 |
| API 邊界 | Spring Cloud Gateway | API 路由、安全、限流 |
| 韌性組件 | Resilience4j | 服務熔斷、重試 |
| 異步通信 | Apache Kafka / RabbitMQ | 事件驅動、服務解耦 |
| 可觀測性 | OpenTelemetry / Grafana Stack | 日誌、指標、追蹤 |
| 分散式追蹤 | Grafana Tempo / Jaeger | 可切換的追蹤後端 |
| 容器化 | Docker / Docker Compose | 環境一致性與服務編排 |
| CI/CD | GitHub Actions | 自動化建置、測試、部署 |
| 安全掃描 | Trivy | 容器鏡像漏洞掃描 |
| 負載測試 | k6 | 性能與壓力測試 |

## 第五章：點燃引擎 (Chapter V: Igniting the Engine)

### 1. 環境要求
本宇宙的運行，需要一個標準化的作戰平台。如果您是從零開始，請首先遵循我們的 **《環境搭建指南》**，完成您本地「熔爐」的建設。這份指南將引導您完成所有必要的準備工作。

> 📖 **[點此查閱：/docs/SETUP.md](docs/SETUP.md)**

### 2. 啟動步驟：創世的儀式 (Ignition: The Genesis Ritual)
當您的作戰平台準備就緒後，便可以開始我們真正的「創世儀式」。我們為此提供了兩種途徑：

#### 方式一：標準啟動 (Standard Launch)
```bash
# 1. clone 倉庫
git clone https://github.com/daVinci-hong/sand-box-microcosm.git

# 2. 進入專案目錄
cd sand-box-microcosm

# 3. 使用 Docker Compose 一鍵啟動所有服務 (預設使用 Tempo 追蹤系統)
docker-compose up -d

# 如果是首次啟動或程式碼有更新，使用：
# docker-compose up --build -d
```

#### 方式二：建築師的饋贈 (The Architect's Gift)
為了提供極致的無摩擦體驗，我們額外提供了一個可選的 `genesis.sh` 輔助script 。它不僅能一鍵啟動所有服務，更能預先處理環境檢查、拉取最新鏡像等繁瑣任務。

這份script ，是我們 **「將規範內嵌於工具」** 核心設計哲學的實體化身。它的使命被精準地定義在 **「創世」** 階段，旨在為您的探索之旅，提供一個完美的、無摩擦的開端。我們相信，一個卓越的系統，不僅在於其自身的強大，更在於其為他人提供的 **「賦能」** 體驗。
```bash
# 1.賦予script 執行權限
chmod +x ./scripts/genesis.sh

#2.執行創世script 
./scripts/genesis.sh
```

### 3. 追蹤系統切換：靈魂的變形 (Tracing System Switch: Soul Metamorphosis)
作為第五幕「不朽的靈魂」的核心展現，本宇宙實現了追蹤系統的無縫切換能力。系統預設使用 **Tempo** 作為分散式追蹤後端，但您可以根據需要切換至 **Jaeger**。

#### 切換至 Jaeger
```bash
# Windows
scripts\switch-compose.bat jaeger

# Linux/WSL
./scripts/switch-compose.sh jaeger
```

#### 切換回 Tempo
```bash
# Windows
scripts\switch-compose.bat tempo

# Linux/WSL
./scripts/switch-compose.sh tempo
```

> 📖 **[完整追蹤系統指南：/docs/TRACING_SYSTEM_GUIDE.md](docs/TRACING_SYSTEM_GUIDE.md)**


## **第六章：建築師的法典 (Chapter VI: The Architect's Codex)**
本宇宙的建造，遵循著一套嚴格的、源於實戰的工程與原則。
我們，在此，僅列其綱要。而其完整的 **《立法記錄 (ADRs)》**與 **《戰役史冊 (AARs)》**，均已，封存於我們的 **【檔案館】** 之中，以待真正的求知者，前來探索。
*   **版本控制：** 受保護主幹的拉取請求工作流
*   **程式碼風格：** Google Java 風格指南
**[👉 點此進入【檔案館】，閱覽我們的完整文件 ](/docs)**



 ## **第七章：測試驗證所 (Chapter VII: The Verification Chamber)**

 想見證我們每一幕「執行結果」的 **「步驟」** 與 **「畫面」** 的同好。

 我們，已將全部五幕劇的 **《驗證記錄》**，完整地，封存於我們的【驗證所】之中。

 **[👉 點此進入【測試驗證所】，閱覽我們所有執行結果](/docs/verifications/)**