graph TD
    %% C2 - Container Diagram for Act IV: The Unyielding Citadel
    %% Version 4.0 - Tactical Upgrade

    A["<b>指揮官 / 開發人員</b>"]
    Ext_Storm["<b>k6 風暴之錘</b><br>[外部負載測試工具]"]

    subgraph "主應用系統"
        direction LR
        
        subgraph "Gateway Service (不屈的堡壘)"
            direction TB
            C1_Core["
                <b>核心路由與過濾引擎</b>
                <br>
                [Spring Cloud Gateway]
            "]

            C1_Resilience["
                <b>三位一体韌性核心</b>
                <br>
                [Resilience4j]
                <br>
                - 限流器 (RateLimiter)
                <br>
                - 艙壁隔離 (Bulkhead)
                <br>
                - 熔斷器 (CircuitBreaker)
            "]

            C1_Core -- "受韌性策略保護" --> C1_Resilience
        end

        Kafka["
            <b>Apache Kafka</b>
            <br>
            [容器: Kafka KRaft]
            <br>
            <br>
            宇宙的中央神經系統
        "]

        C2["
            <b>Beacon Service</b>
            <br>
            [容器: Spring Boot]
            <br>
            <br>
            角色: 事件消費者
        "]
    end

    subgraph "全知之眼 - 可觀測性系統"
        Grafana["
            <b>Grafana</b>
            <br>
            [容器: Grafana]
            <br>
            <br>
            <b>新增: 韌性戰情室</b>
        "]
        Prometheus["<b>Prometheus</b>"]
        %% Other components hidden for clarity
    end

    %% Data Flows
    Ext_Storm -- "1 發起『完美風暴』" --> C1_Core
    C1_Resilience -- "2 (若通過) 發布事件" --> Kafka
    Kafka -- "3 消費事件" --> C2

    C1_Resilience -- "韌性指標" --> Prometheus
    Prometheus -- "數據源" --> Grafana
    A -- "觀察與洞察" --> Grafana