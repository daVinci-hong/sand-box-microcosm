# ADR-010: 採用抽象化與標準化介面，實現核心基礎設施組件的可互換性

**狀態：** 已接納 (Accepted)
**日期：** 【2025-09-19】

---

## 背景 (Context)

我們已成功地，為我們的宇宙，鑄造了堅固的管道、邊界、意識、與意志。現在，我們面臨一個**終極的、哲學層面的**挑戰：**我們的宇宙，是否，僅僅是，其所有零件的總和？**

如果我們的核心業務邏輯，與某一個具體的技術實現（如 Kafka, Tempo）**被焊死**在一起，那麼，我們的宇宙，就是脆弱的、短視的、且注定會被技術的浪潮所淘汰的。

為了踐行「第五幕：無痛換心」的核心敘事，我們必須證明，我們的架構，具備**超越其當前物理形態**的、更高級的**「演進能力」**。

## 決策 (Decision)

我們決定，將**「面向介面而非實作 (Program to an interface, not an implementation)」**這一設計原則，正式提升為我們整個宇宙的**最高架構憲法**。

我們將通過以下兩場標誌性的「外科手術」，來將此憲法，轉化為堅實的、可被驗證的現實：

1.  **心臟移植手術 (訊息 middleware 遷移):**
    *   **第一步 (抽象化):** 我們將在 `common-library` 中，創建一個**通用的 `MessagingService` 介面**。我們現有的、與 Kafka 強耦合的生產者程式碼，將被重構為**只依賴**這個抽象介面。
    *   **第二步 (多重實現):** 我們將為這個介面，提供**至少兩個**具體的實現（`KafkaMessagingService`, `RabbitMQMessagingService`），並利用 **Spring Profiles** 機制，來在啟動時，動態地，選擇激活哪一個「心臟」。
    *   **第三步 (驗證):** 我們將證明，我們可以在**不修改任何一行業務程式碼**的情況下，僅通過一個配置的變更，就完成從 Kafka 到 RabbitMQ 的無縫遷移。

2.  **視神經移植手術 (追蹤後端遷移):**
    *   **第一步 (依賴標準):** 我們將**重申並驗證**我們在 `ADR-008` 中所做的、擁抱 **OpenTelemetry (OTel)** 這一**開放標準**的偉大決策。
    *   **第二步 (驗證):** 我們將證明，由於我們的所有服務，都只與 OTel Agent 這個**標準化的「插座」**對話，因此，我們可以，通過**僅僅修改基礎設施的配置**（在 `docker-compose.yml` 中，將 Tempo 容器，替換為 Jaeger 容器），就能完成追蹤後端的無縫遷移，而**無需，觸碰，任何一個** Java 服務的程式碼或配置。

## 理由 (Consequences)

### 積極方面：

*   **終極的技術敏捷性 (Ultimate Technological Agility):**
    *   此舉，將我們從 **「技術的囚徒」**，變成了 **「技術的主人」**。我們不再被任何一個單一的供應商或開源項目所綁定，我們獲得了根據未來的業務需求、成本考量、或技術趨勢，**自由選擇**我們基礎設施的終極權力。
*   **架構的未來兼容性 (Future-Proof Architecture):**
    *   我們的宇宙，從此，具備了 **抵禦「技術過時」** 這一最大風險的能力。它的核心業務邏輯，將能夠在未來的技術浪潮中，平滑地，遷移到新的、更先進的平台之上。
*   **「活的履歷」的巔峰之作：**
    *   成功地，執行並驗證這兩場「外科手術」，是我們**架構設計能力的、最雄辯的、無可辯駁的**最終證明。它展示的，是一種遠超普通工程師的、**真正的「總建築師」級別**的戰略視野。

### 消極方面（權衡）：

*   **抽象的成本 (The Cost of Abstraction):**
    *   引入抽象層（如 `MessagingService` 介面），會輕微地增加程式碼的複雜度和間接性。我們必須確保，我們的抽象，是**簡潔的、必要的、且沒有泄露底層實現細節的**。
*   **通用性的限制 (Limitation of Generality):**
    *   一個通用的介面，可能無法利用某一個具體實現的、獨有的高級特性。例如，一個通用的 `MessagingService`，可能無法完美地，體現 Kafka Streams 的所有能力。我們接受這個權衡，因為在我們的核心目標中，**「可互換性」**的優先級，高於**「對特定工具的極致優化」**。

---
**文件結束**